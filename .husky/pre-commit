#!/usr/bin/env bash

# Pre-commit hook: Run ESLint on staged files and all tests
# To bypass all checks for an emergency commit, use: git commit --no-verify

# Run ESLint on staged files
echo "ğŸ”§ Running ESLint on staged files..."
bunx lint-staged

if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ COMMIT REJECTED: ESLint found errors that could not be auto-fixed"
  echo ""
  echo "Please fix the errors above and try again."
  echo ""
  exit 1
fi

echo "âœ… ESLint passed"
echo ""

# Run full test suite across all packages
echo "ğŸ§ª Running tests..."
bun run test

if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ COMMIT REJECTED: One or more tests failed"
  echo ""
  echo "Please fix the failing tests above and try again."
  echo ""
  exit 1
fi

echo "âœ… All tests passed"
echo ""
echo "âœ… All checks passed"
